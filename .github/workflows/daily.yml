name: TrendRadar Daily Push

on:
  schedule:
    - cron: '0 23 * * *'  # UTCæ—¶é—´23ç‚¹ = å°æ¹¾æ—¶é—´æ—©ä¸Š7ç‚¹
  workflow_dispatch:      # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  run-trendradar:
    runs-on: ubuntu-latest

    env:
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run TrendRadar script
        run: python main.py  # è¯·ç¡®ä¿è¯¥è„šæœ¬ç”Ÿæˆ output/summary.txt

      - name: Push Telegram Hotspot Summary
        run: |
          if [ -s output/summary.txt ]; then
            TEXT=$(cat output/summary.txt)
            echo "ğŸ“¤ æ­£åœ¨å‘é€æ¶ˆæ¯ï¼š$TEXT"
            curl -s -X POST https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage \
              -d chat_id=${TELEGRAM_CHAT_ID} \
              -d text="$TEXT" \
              -d parse_mode="Markdown"
          else
            echo "âš ï¸ æœªæ‰¾åˆ°çƒ­ç‚¹æ‘˜è¦æˆ–å†…å®¹ä¸ºç©ºï¼Œè·³è¿‡æ¨é€"
          fi

      - name: Debug Telegram Push
        run: |
          echo "ğŸ“‚ æ–‡ä»¶å†…å®¹é¢„è§ˆï¼š"
          cat output/summary.txt || echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è¯»å–"
          echo "ğŸ” Chat ID: ${TELEGRAM_CHAT_ID}"
          echo "ğŸ” Token: ${TELEGRAM_TOKEN:0:10}... (å·²éšè—)"
